<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nifty 50 OI Live Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        font-family: 'Segoe UI', sans-serif;
        background: #0f172a;
        color: #f1f5f9;
        padding: 20px;
        margin: 0;
        animation: fadeIn 1s ease-in;
      }

      h1 {
        text-align: center;
        font-size: 2.5rem;
        margin-bottom: 20px;
        color: #38bdf8;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 30px;
        background: #1e293b;
        border-radius: 12px;
        overflow: hidden;
        animation: slideUp 0.8s ease-in-out;
      }

      th, td {
        padding: 12px;
        border: 1px solid #334155;
        text-align: center;
      }

      th {
        background-color: #0f172a;
        color: #38bdf8;
      }

      td.call {
        background-color: #064e3b;
        color: #34d399;
        font-weight: bold;
      }

      td.put {
        background-color: #7f1d1d;
        color: #f87171;
        font-weight: bold;
      }

      canvas {
        background: #1e293b;
        padding: 20px;
        border-radius: 16px;
      }

      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      @keyframes slideUp {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
      }
    </style>
  </head>
  <body>
    <h1>Nifty 50 OI Live Dashboard</h1>
    <div id="data-container">Loading data...</div>
    <canvas id="chart" height="100"></canvas>

    <script>
      const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTWOYX3LIRi8DMElflq4ENzCF32gFfZcrGfOMUQUToRa_-DnrOHQiFEW4vtaj8fY4PxtH4M-dUMkAGc/pub?output=csv';

      fetch(sheetURL)
        .then(res => res.text())
        .then(data => {
          const rows = data.split('\n').map(row => row.split(','));
          const headerIndex = rows.findIndex(row => row[0].trim() === 'SYMBOL');
          const validRows = rows.slice(headerIndex + 2).filter(row => row[0]);
          const headers = rows[headerIndex + 1];

          const table = document.createElement('table');
          const thead = document.createElement('thead');
          const tbody = document.createElement('tbody');

          const headerRow = document.createElement('tr');
          headers.forEach(h => {
            const th = document.createElement('th');
            th.textContent = h.trim();
            headerRow.appendChild(th);
          });
          thead.appendChild(headerRow);

          const labels = [];
          const callOI = [];
          const putOI = [];

          validRows.forEach(row => {
            const tr = document.createElement('tr');
            row.forEach((cell, i) => {
              const td = document.createElement('td');
              td.textContent = cell.trim();

              // CALL/PUT styling
              if (headers[i].toLowerCase().includes('call')) td.classList.add('call');
              if (headers[i].toLowerCase().includes('put')) td.classList.add('put');

              tr.appendChild(td);
            });
            tbody.appendChild(tr);

            // Add chart data if exists
            labels.push(row[0]);
            callOI.push(parseInt(row[headers.indexOf('CALL OI')]) || 0);
            putOI.push(parseInt(row[headers.indexOf('PUT OI')]) || 0);
          });

          table.appendChild(thead);
          table.appendChild(tbody);
          document.getElementById('data-container').innerHTML = '';
          document.getElementById('data-container').appendChild(table);

          new Chart(document.getElementById('chart'), {
            type: 'bar',
            data: {
              labels,
              datasets: [
                {
                  label: 'CALL OI',
                  data: callOI,
                  backgroundColor: '#22c55e'
                },
                {
                  label: 'PUT OI',
                  data: putOI,
                  backgroundColor: '#ef4444'
                }
              ]
            },
            options: {
              responsive: true,
              scales: {
                x: {
                  ticks: { color: '#f1f5f9' }
                },
                y: {
                  ticks: { color: '#f1f5f9' }
                }
              },
              plugins: {
                legend: {
                  labels: { color: '#f1f5f9' }
                }
              }
            }
          });
        });
    </script>
  </body>
</html>
